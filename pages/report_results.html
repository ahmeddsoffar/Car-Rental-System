<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Report Results - Car Rental System</title>
    <link rel="stylesheet" href="../css/search_result.css" />
  </head>
  <body>
    <div class="navbar">
      <h1>Car Rental Admin</h1>
      <div class="navbar-links">
        <a href="admin_dashboard.html">Dashboard</a>
        <a href="advanced_search.html">Reservations</a>
        <a href="generate_reports.html">Reports</a>
        <a href="1login_page.html">Logout</a>
      </div>
    </div>

    <div class="container">
      <h1>Report Results</h1>

      <div class="card">
        <h2 id="report-title">Report Details</h2>
        <div class="table-container">
          <table id="report-table">
            <thead id="report-headers">
              <!-- Headers will be dynamically inserted based on report type -->
            </thead>
            <tbody id="results-body">
              <!-- Results will be inserted dynamically here -->
            </tbody>
          </table>
        </div>
      </div>

      <div class="back-button">
        <a href="generate_reports.html" class="btn">Back to Reports</a>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const urlParams = new URLSearchParams(window.location.search);
        const reportType = urlParams.get("report_type");
        const queryString = urlParams.toString();

        // Define headers for different report types
        const headerConfigs = {
          report1: [
            "Car ID",
            "Year",
            "Car Model",
            "Plate ID",
            "Color",
            "Motor Type",
            "Seats",
            "Car Type",
            "Price per Day",
            "Office ID",
            "Username",
            "Address",
            "First Name",
            "Last Name",
            "Email",
            "Phone",
            "License",
            "Reservation ID",
            "Reservation Date",
            "Pickup Date",
            "Return Date",
          ],
          report2: [
            "Reservation ID",
            "Customer Name",
            "Pickup Date",
            "Return Date",
            "Status",
          ],
          report3: [
            "Car ID",
            "Model",
            "Status",
            "Current Customer",
            "Return Date",
          ],
          report4: [
            "Reservation ID",
            "Car ID",
            "Car Model",
            "Pickup Date",
            "Return Date",
            "Status",
          ],
          report5: [
            "Date",
            "Total Payments",
            "Number of Reservations",
            "Average Payment",
          ],
        };

        // Set report title
        const reportTitles = {
          report1: "All Reservations Within Period",
          report2: "Car Reservations",
          report3: "Car Status Report",
          report4: "Customer Reservations",
          report5: "Daily Payments Report",
        };

        document.getElementById("report-title").textContent =
          reportTitles[reportType] || "Report Details";

        // Set table headers
        const headers = headerConfigs[reportType] || [];
        const headerRow = document.createElement("tr");
        headers.forEach((header) => {
          const th = document.createElement("th");
          th.textContent = header;
          headerRow.appendChild(th);
        });
        document.getElementById("report-headers").appendChild(headerRow);

        // Fetch report data
        const apiUrl = `http://localhost/finallabdb/backend/generate_report.php?${queryString}`;

        fetch(apiUrl)
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
          })
          .then((data) => {
            const tbody = document.getElementById("results-body");

            if (!data || data.length === 0) {
              tbody.innerHTML = `<tr><td colspan="${headers.length}" style="text-align: center;">No results found</td></tr>`;
              return;
            }

            tbody.innerHTML = ""; // Clear existing content

            data.forEach((item) => {
              const row = document.createElement("tr");
              // Create cells based on report type
              switch (reportType) {
                case "report1":
                  row.innerHTML = `
                                    <td>${item.CarID || "N/A"}</td>
                                    <td>${item.Year || "N/A"}</td>
                                    <td>${item.model || "N/A"}</td>
                                    <td>${item.PlateID || "N/A"}</td>
                                    <td>${item.color || "N/A"}</td>
                                    <td>${item.motor_type || "N/A"}</td>
                                    <td>${item.No_of_seats || "N/A"}</td>
                                    <td>${item.carType || "N/A"}</td>
                                    <td>${item.price_per_day || "N/A"}</td>
                                    <td>${item.office_ID || "N/A"}</td>
                                    <td>${item.username || "N/A"}</td>
                                    <td>${item.Address || "N/A"}</td>
                                    <td>${item.First_name || "N/A"}</td>
                                    <td>${item.Last_name || "N/A"}</td>
                                    <td>${item.email || "N/A"}</td>
                                    <td>${item.phone_no || "N/A"}</td>
                                    <td>${item.license_no || "N/A"}</td>
                                    <td>${item.reservation_ID || "N/A"}</td>
                                    <td>${item.reservation_Date || "N/A"}</td>
                                    <td>${item.pickup_date || "N/A"}</td>
                                    <td>${item.return_date || "N/A"}</td>
                                `;
                  break;
                case "report5":
                  row.innerHTML = `
                                    <td>${item.date || "N/A"}</td>
                                    <td>$${item.total_payments || "0"}</td>
                                    <td>${item.reservation_count || "0"}</td>
                                    <td>$${item.average_payment || "0"}</td>
                                `;
                  break;
                // Add cases for other report types as needed
              }
              tbody.appendChild(row);
            });
          })
          .catch((error) => {
            console.error("Error:", error);
            const tbody = document.getElementById("results-body");
            tbody.innerHTML = `
                        <tr>
                            <td colspan="${headers.length}" style="text-align: center; color: var(--text-secondary);">
                                An error occurred while fetching the report data. Please try again later.
                            </td>
                        </tr>
                    `;
          });
      });
    </script>
  </body>
</html>
